<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電力自動配對系統</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; margin-bottom: 25px; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .input-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        .button-group { display: flex; gap: 10px; margin-bottom: 25px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .btn-add { background-color: #27ae60; color: white; }
        .btn-add:hover { background-color: #219150; }
        .btn-export { background-color: #3498db; color: white; }
        .btn-export:hover { background-color: #2980b9; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; font-size: 14px; }
        th { background-color: #f8f9fa; font-weight: bold; }
        tr:nth-child(even) { background-color: #fafafa; }
        .highlight { font-weight: bold; color: #2980b9; }
    </style>
</head>
<body>

<div class="container">
    <h2>電力自動配對系統</h2>
    
    <div class="input-grid">
        <div class="form-group">
            <label>設備名稱</label>
            <input type="text" id="deviceName" placeholder="例如：1F 冷氣主機">
        </div>
        <div class="form-group">
            <label>需求電流 (A)</label>
            <input type="number" id="inputAmp" placeholder="請輸入數值">
        </div>
        <div class="form-group">
            <label>芯數 (Core)</label>
            <select id="coreCount">
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
            </select>
        </div>
        <div class="form-group">
            <label>絕緣型式</label>
            <select id="insulation">
                <option value="XLPE">XLPE</option>
                <option value="PVC">PVC</option>
            </select>
        </div>
    </div>

    <div class="button-group">
        <button class="btn-add" onclick="addRecord()">新增至列表</button>
        <button class="btn-export" onclick="exportToExcel()">導出 Excel 報表</button>
    </div>

    <table id="resultTable">
        <thead>
            <tr>
                <th>設備</th>
                <th>需求電流(A)</th>
                <th>芯數</th>
                <th>絕緣型式</th>
                <th>建議線徑(mm²)</th>
                <th>接地線(mm²)</th>
                <th>PVC管徑(mm)</th>
                <th>EMT管徑(mm)</th>
                <th>RSG管徑(mm)</th>
            </tr>
        </thead>
        <tbody id="resultBody"></tbody>
    </table>
</div>

<script>
// 完整載流量數據 (依據圖片 1 整理)
const ampTable = {
    'XLPE': [
        {sq: 1.6, cores: {3:24, 4:21, 5:19, 6:19}}, {sq: 2, cores: {3:28, 4:25, 5:22, 6:22}},
        {sq: 2.6, cores: {3:39, 4:35, 5:31, 6:31}}, {sq: 3.5, cores: {3:30, 4:27, 5:24, 6:24}},
        {sq: 5.5, cores: {3:39, 4:35, 5:31, 6:31}}, {sq: 8, cores: {3:51, 4:46, 5:41, 6:41}},
        {sq: 14, cores: {3:74, 4:67, 5:59, 6:59}}, {sq: 22, cores: {3:93, 4:84, 5:74, 6:74}},
        {sq: 30, cores: {3:116, 4:104, 5:93, 6:93}}, {sq: 38, cores: {3:130, 4:117, 5:104, 6:104}},
        {sq: 50, cores: {3:155, 4:140, 5:124, 6:124}}, {sq: 60, cores: {3:176, 4:159, 5:141, 6:141}},
        {sq: 80, cores: {3:208, 4:187, 5:167, 6:167}}, {sq: 100, cores: {3:242, 4:218, 5:194, 6:194}},
        {sq: 125, cores: {3:277, 4:249, 5:221, 6:221}}, {sq: 150, cores: {3:309, 4:278, 5:247, 6:247}}
    ],
    'PVC': [
        {sq: 1.6, cores: {3:13, 4:12, 5:10, 6:10}}, {sq: 2, cores: {3:18, 4:16, 5:14, 6:14}},
        {sq: 2.6, cores: {3:24, 4:22, 5:19, 6:19}}, {sq: 3.5, cores: {3:19, 4:16, 5:14, 6:14}},
        {sq: 5.5, cores: {3:25, 4:23, 5:20, 6:20}}, {sq: 8, cores: {3:33, 4:30, 5:25, 6:25}},
        {sq: 14, cores: {3:50, 4:40, 5:35, 6:35}}, {sq: 22, cores: {3:60, 4:55, 5:50, 6:50}},
        {sq: 30, cores: {3:75, 4:65, 5:55, 6:55}}, {sq: 38, cores: {3:85, 4:75, 5:65, 6:65}},
        {sq: 50, cores: {3:100, 4:90, 5:80, 6:80}}, {sq: 60, cores: {3:115, 4:105, 5:90, 6:90}}
    ]
};

// 導線管徑數據 (依據圖片 2 整理)
const conduitTable = {
    1.6: {pvc: 16, emt: 15, rsg: 16}, 2: {pvc: 16, emt: 19, rsg: 16},
    2.6: {pvc: 20, emt: 25, rsg: 22}, 3.5: {pvc: 16, emt: 19, rsg: 16},
    5.5: {pvc: 16, emt: 25, rsg: 22}, 8: {pvc: 20, emt: 25, rsg: 22},
    14: {pvc: 28, emt: 31, rsg: 28}, 22: {pvc: 35, emt: 31, rsg: 28},
    30: {pvc: 35, emt: 39, rsg: 36}, 38: {pvc: 41, emt: 39, rsg: 36},
    50: {pvc: 52, emt: 51, rsg: 42}, 60: {pvc: 52, emt: 51, rsg: 54},
    80: {pvc: 67, emt: 63, rsg: 54}, 100: {pvc: 67, emt: 75, rsg: 70}
};

function addRecord() {
    const name = document.getElementById('deviceName').value || "未命名";
    const amp = parseFloat(document.getElementById('inputAmp').value);
    const core = document.getElementById('coreCount').value;
    const insu = document.getElementById('insulation').value;

    if (isNaN(amp)) { alert("請輸入有效的需求電流"); return; }

    let selectedSq = null;
    const dataSet = ampTable[insu];

    for (let item of dataSet) {
        if (item.cores[core] >= amp) {
            selectedSq = item.sq;
            break;
        }
    }

    if (!selectedSq) {
        alert("找不到符合該電流的線徑規格");
        return;
    }

    const cond = conduitTable[selectedSq] || {pvc: "待定", emt: "待定", rsg: "待定"};
    const tbody = document.getElementById('resultBody');
    const row = `
        <tr>
            <td>${name}</td>
            <td>${amp}</td>
            <td>${core}C</td>
            <td>${insu}</td>
            <td class="highlight">${selectedSq}</td>
            <td>${selectedSq}</td>
            <td>${cond.pvc}</td>
            <td>${cond.emt}</td>
            <td>${cond.rsg}</td>
        </tr>
    `;
    tbody.insertAdjacentHTML('beforeend', row);
}

function exportToExcel() {
    const table = document.getElementById("resultTable");
    const wb = XLSX.utils.table_to_book(table, { sheet: "電力配對結果" });
    XLSX.writeFile(wb, "電力自動配對報表.xlsx");
}
</script>

</body>
</html>
