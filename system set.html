<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工程旗艦系統 - 系統中心</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --success: #27ae60; --bg: #f4f7f9; --border: #dee2e6; }
        body { font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; margin: 0; background: var(--bg); }
        
        /* Navbar */
        .navbar { background: var(--primary); color: white; padding: 0 40px; height: 65px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .nav-brand { font-size: 1.4rem; font-weight: bold; }
        .nav-links a { color: #bdc3c7; text-decoration: none; margin-left: 20px; transition: 0.3s; font-size: 0.95rem; }
        .nav-links a:hover { color: white; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid var(--border); }
        .card-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; color: var(--primary); border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        .card-title i { color: var(--accent); }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: 600; }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; box-sizing: border-box; }

        /* 設備表格 */
        .device-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .device-table th { background: #f8f9fa; text-align: left; padding: 12px; font-size: 0.85rem; color: #7f8c8d; border-bottom: 2px solid var(--border); }
        .device-table td { padding: 8px; border-bottom: 1px solid #eee; }
        .device-table input { padding: 6px; font-size: 0.9rem; border: 1px transparent solid; }
        .device-table input:focus { border: 1px solid var(--accent); outline: none; background: #fff; }
        
        .btn-add { background: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; margin-top: 10px; font-size: 0.85rem; }
        .btn-del { color: #e74c3c; border: none; background: none; cursor: pointer; }

        .btn-save-main { background: var(--success); color: white; border: none; padding: 12px 40px; border-radius: 30px; font-size: 1rem; cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(39,174,96,0.3); }
        .btn-save-main:hover { transform: translateY(-2px); }
        
        .hint { font-size: 0.75rem; color: #999; margin-top: 5px; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-brand"><i class="fas fa-microchip"></i> 工程旗艦管理系統</div>
        <div class="nav-links">
            <a href="index.html"><i class="fas fa-calculator"></i>← 返回首頁</a>
        </div>
    </nav>

    <div class="container">
        <div class="header-flex">
            <div>
                <h1 style="margin:0">系統設定</h1>
                <p style="color:#7f8c8d; margin:5px 0 0 0;">管理報價清單、工程基準與環境偏好</p>
            </div>
            <button class="btn-save-main" onclick="saveAll()"><i class="fas fa-save"></i> 儲存所有設定</button>
        </div>

        <div class="grid">
            <div class="card" style="grid-column: span 2;">
                <div class="card-title"><i class="fas fa-boxes"></i> 設備選單管理 (Inventory)</div>
                <table class="device-table" id="deviceTable">
                    <thead>
                        <tr>
                            <th width="20%">類別 (如:FFU)</th>
                            <th width="45%">規格名稱</th>
                            <th width="25%">單價 (TWD)</th>
                            <th width="10%">刪除</th>
                        </tr>
                    </thead>
                    <tbody id="deviceBody">
                        </tbody>
                </table>
                <button class="btn-add" onclick="addDeviceRow()"><i class="fas fa-plus"></i> 新增設備選項</button>
                <p class="hint">* 變更會立即影響計算頁面的下拉選單內容與預設價格。</p>
            </div>

            <div class="card">
                <div class="card-title"><i class="fas fa-chart-line"></i> 財務與加成 (Financial)</div>
                <div class="form-group">
                    <label>預設利潤倍率 (Markup)</label>
                    <input type="number" id="cfg_markup" value="1.2" step="0.05">
                    <span class="hint">1.2 代表成本 x 120%</span>
                </div>
                <div class="form-group">
                    <label>營業稅率 (%)</label>
                    <input type="number" id="cfg_tax" value="5">
                </div>
            </div>

            <div class="card">
                <div class="card-title"><i class="fas fa-drafting-compass"></i> 工程基準參數 (Technical)</div>
                <div class="form-group">
                    <label>安全係數 Safety Factor (%)</label>
                    <input type="number" id="cfg_safety" value="15">
                </div>
                <div class="form-group">
                    <label>電力單價 (TWD/kWh)</label>
                    <input type="number" id="cfg_elec" value="4.5">
                </div>
            </div>

            <div class="card" style="grid-column: span 2;">
                <div class="card-title"><i class="fas fa-sliders-h"></i> 系統偏好 (Preferences)</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>顯示語言</label>
                        <select id="cfg_lang">
                            <option value="zh-TW">繁體中文 (Traditional Chinese)</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>預設貨幣符號</label>
                        <input type="text" id="cfg_currency" value="TWD">
                    </div>
                    <div class="form-group">
                        <label>界面模式</label>
                        <select id="cfg_theme">
                            <option value="light">明亮模式 (Light)</option>
                            <option value="dark">深色模式 (Dark)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Excel 匯出格式</label>
                        <input type="text" id="cfg_export" value="{Project}_{Date}">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化資料庫
        let devices = [
            { cat: "FFU", name: "DC 1080 CMH 標準型", price: 12500 },
            { cat: "Chiller", name: "水冷式主機 50RT", price: 450000 },
            { cat: "Light", name: "LED 平板燈 40W", price: 1800 }
        ];

        window.onload = function() {
            // 從 LocalStorage 載入設備
            const savedDevs = localStorage.getItem('eng_sys_devices');
            if (savedDevs) devices = JSON.parse(savedDevs);
            
            // 從 LocalStorage 載入設定
            const savedCfg = localStorage.getItem('eng_sys_config');
            if (savedCfg) {
                const cfg = JSON.parse(savedCfg);
                document.getElementById('cfg_markup').value = cfg.markup || 1.2;
                document.getElementById('cfg_tax').value = cfg.tax || 5;
                document.getElementById('cfg_safety').value = cfg.safety || 15;
                document.getElementById('cfg_elec').value = cfg.elec || 4.5;
                document.getElementById('cfg_lang').value = cfg.lang || "zh-TW";
                document.getElementById('cfg_currency').value = cfg.currency || "TWD";
                document.getElementById('cfg_theme').value = cfg.theme || "light";
                document.getElementById('cfg_export').value = cfg.export || "{Project}_{Date}";
            }
            renderTable();
        };

        function renderTable() {
            const tbody = document.getElementById('deviceBody');
            tbody.innerHTML = "";
            devices.forEach((d, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td><input type="text" value="${d.cat}" onchange="updateDev(${index}, 'cat', this.value)"></td>
                        <td><input type="text" value="${d.name}" onchange="updateDev(${index}, 'name', this.value)"></td>
                        <td><input type="number" value="${d.price}" onchange="updateDev(${index}, 'price', this.value)"></td>
                        <td><button class="btn-del" onclick="removeDev(${index})"><i class="fas fa-trash"></i></button></td>
                    </tr>
                `;
            });
        }

        function addDeviceRow() {
            devices.push({ cat: "新類別", name: "新規格名稱", price: 0 });
            renderTable();
        }

        function updateDev(i, field, val) { devices[i][field] = (field === 'price') ? parseFloat(val) : val; }
        function removeDev(i) { if(confirm("確定刪除此設備？")) { devices.splice(i, 1); renderTable(); } }

        function saveAll() {
            // 儲存
            localStorage.setItem('eng_sys_devices', JSON.stringify(devices));
            
            const config = {
                markup: document.getElementById('cfg_markup').value,
                tax: document.getElementById('cfg_tax').value,
                safety: document.getElementById('cfg_safety').value,
                elec: document.getElementById('cfg_elec').value,
                lang: document.getElementById('cfg_lang').value,
                currency: document.getElementById('cfg_currency').value,
                theme: document.getElementById('cfg_theme').value,
                export: document.getElementById('cfg_export').value
            };
            localStorage.setItem('eng_sys_config', JSON.stringify(config));
            
            alert("設定儲存成功！請回到計算頁面重新載入即可看到最新參數。");
        }
    </script>
</body>
</html>
